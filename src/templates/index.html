<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokemon Card Collection</title>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #f5f5f5;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .stat-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }
        
        .filters {
            background: white;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .filter-label {
            font-size: 12px;
            font-weight: 600;
            color: #555;
            text-transform: uppercase;
        }
        
        select, input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            width: 100%;
        }
        
        button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            background: #007bff;
            color: white;
            transition: background 0.2s;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        button.secondary {
            background: #6c757d;
        }
        
        button.secondary:hover {
            background: #545b62;
        }
        
        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 15px;
        }
        
        .card {
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .card img {
            width: 125px;
            height: auto;
            border-radius: 4px;
            display: block;
            margin: 0 auto;
        }
        
        .card-name {
            font-size: 12px;
            font-weight: 600;
            margin-top: 8px;
            text-align: center;
        }
        
        .card-qty {
            font-size: 11px;
            color: #666;
            text-align: center;
            margin-top: 4px;
        }
        
        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .modal {
            background: white;
            border-radius: 12px;
            max-width: 1100px;
            width: 95vw;
            max-height: 90vh;
            overflow-y: auto;
            padding: 30px;
            position: relative;
        }
        
        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
        }
        
        .modal-close:hover {
            background: #f0f0f0;
        }
        
        .modal-image-container img {
            width: 100%;
            max-width: 320px;
            height: auto;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            display: block;
            transition: transform 0.2s;
        }
        
        .modal-image-container img:hover {
            transform: scale(1.02);
        }
        
        .modal-content {
            display: grid;
            grid-template-columns: 320px 1fr;
            gap: 30px;
            align-items: start;
        }
        
        @media (max-width: 900px) {
            .modal-content {
                grid-template-columns: 1fr;
            }
            
            .modal-image-container {
                max-width: 100%;
            }
        }
        
        .modal-image-container {
            position: sticky;
            top: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .modal-sections {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .modal-section {
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
        }
        
        .modal-section-title {
            background: #f8f8f8;
            padding: 8px 12px;
            font-weight: 700;
            font-size: 13px;
            text-transform: uppercase;
            color: #555;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .modal-table {
            width: 100%;
        }
        
        .modal-table tr {
            border-bottom: 1px solid #f0f0f0;
        }
        
        .modal-table tr:last-child {
            border-bottom: none;
        }
        
        .modal-table td {
            padding: 8px 12px;
            font-size: 13px;
        }
        
        .modal-table td:first-child {
            font-weight: 600;
            color: #666;
            width: 40%;
            vertical-align: top;
            background: #fafafa;
        }
        
        .modal-table td:last-child {
            color: #333;
        }
        
        .type-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            margin-right: 4px;
            background: #e0e0e0;
            color: #333;
        }
        
        .attack-item, .ability-item {
            margin-bottom: 8px;
            padding: 8px;
            background: #f9f9f9;
            border-radius: 4px;
        }
        
        .attack-item:last-child, .ability-item:last-child {
            margin-bottom: 0;
        }
        
        .attack-name, .ability-name {
            font-weight: 600;
            color: #333;
        }
        
        .attack-cost {
            color: #666;
            font-size: 12px;
        }
        
        .attack-damage {
            color: #d32f2f;
            font-weight: 600;
            margin-left: 8px;
        }
        
        .attack-effect, .ability-effect {
            color: #555;
            font-size: 12px;
            margin-top: 4px;
            font-style: italic;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 18px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container" x-data="cardApp()" x-init="init()">
        <!-- Header -->
        <header>
            <h1>ðŸŽ´ Pokemon Card Collection</h1>
        </header>
        
        <!-- Stats -->
        <div class="stats" x-show="stats">
            <div class="stat-card">
                <div class="stat-label">Unique Cards</div>
                <div class="stat-value" x-text="stats?.unique_cards || 0"></div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total Cards</div>
                <div class="stat-value" x-text="stats?.total_cards || 0"></div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Sets</div>
                <div class="stat-value" x-text="stats?.sets_count || 0"></div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total Value</div>
                <div class="stat-value" x-text="'â‚¬' + (stats?.total_value_eur || 0).toFixed(2)"></div>
            </div>
        </div>
        
        <!-- Filters -->
        <div class="filters">
            <div class="filter-group">
                <label class="filter-label" for="language">Language</label>
                <select id="language" x-model="filters.language" @change="loadCards()">
                    <option value="de">German</option>
                    <option value="en">English</option>
                    <option value="fr">French</option>
                    <option value="es">Spanish</option>
                    <option value="it">Italian</option>
                    <option value="pt">Portuguese</option>
                    <option value="ja">Japanese</option>
                    <option value="ko">Korean</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label class="filter-label" for="name">Name Search</label>
                <input id="name" type="text" x-model="filters.name" @input="loadCards()" placeholder="Search cards...">
            </div>
            
            <div class="filter-group">
                <label class="filter-label" for="setId">Set ID</label>
                <select id="setId" x-model="filters.setId" @change="loadCards()">
                    <option value="">All Sets</option>
                    <template x-for="set in filterOptions.sets" :key="set">
                        <option :value="set" x-text="set"></option>
                    </template>
                </select>
            </div>
            
            <div class="filter-group">
                <label class="filter-label" for="type">Type</label>
                <select id="type" x-model="filters.type" @change="loadCards()">
                    <option value="">All Types</option>
                    <template x-for="type in filterOptions.types" :key="type">
                        <option :value="type" x-text="type"></option>
                    </template>
                </select>
            </div>
            
            <div class="filter-group">
                <label class="filter-label" for="category">Category</label>
                <select id="category" x-model="filters.category" @change="loadCards()">
                    <option value="">All Categories</option>
                    <template x-for="cat in filterOptions.categories" :key="cat">
                        <option :value="cat" x-text="cat"></option>
                    </template>
                </select>
            </div>
            
            <div class="filter-group">
                <label class="filter-label" for="rarity">Rarity</label>
                <select id="rarity" x-model="filters.rarity" @change="loadCards()">
                    <option value="">All Rarities</option>
                    <template x-for="rarity in filterOptions.rarities" :key="rarity">
                        <option :value="rarity" x-text="rarity"></option>
                    </template>
                </select>
            </div>
            
            <div class="filter-group">
                <label class="filter-label" for="stage">Stage</label>
                <select id="stage" x-model="filters.stage" @change="loadCards()">
                    <option value="">All Stages</option>
                    <template x-for="stage in filterOptions.stages" :key="stage">
                        <option :value="stage" x-text="stage"></option>
                    </template>
                </select>
            </div>
            
            <div class="filter-group">
                <label class="filter-label" for="regulationMark">Regulation Mark</label>
                <select id="regulationMark" x-model="filters.regulationMark" @change="loadCards()">
                    <option value="">All Marks</option>
                    <template x-for="mark in filterOptions.regulation_marks" :key="mark">
                        <option :value="mark" x-text="mark"></option>
                    </template>
                </select>
            </div>
            
            <div class="filter-group">
                <label class="filter-label" for="legalStandard">Standard Legal</label>
                <select id="legalStandard" x-model="filters.legalStandard" @change="loadCards()">
                    <option value="">All Cards</option>
                    <option value="true">Legal Only</option>
                    <option value="false">Not Legal</option>
                </select>
            </div>
            
            <div class="filter-group" style="align-self: end;">
                <button @click="clearFilters()" class="secondary">Clear Filters</button>
            </div>
        </div>
        
        <!-- Loading -->
        <div class="loading" x-show="loading">
            Loading cards...
        </div>
        
        <!-- Results count -->
        <div x-show="!loading && cardGroups.length > 0" style="text-align: center; margin-bottom: 15px; color: #666; font-size: 14px;">
            Showing <span x-text="cardGroups.length"></span> unique card<span x-text="cardGroups.length !== 1 ? 's' : ''"></span>
        </div>
        
        <!-- Empty state -->
        <div x-show="!loading && cardGroups.length === 0" class="loading">
            No cards found matching your filters.
        </div>
        
        <!-- Gallery -->
        <div class="gallery" x-show="!loading && cardGroups.length > 0">
            <template x-for="group in cardGroups" :key="group.tcgdex_id">
                <div class="card" @click="openModal(group)">
                    <img :src="getThumbnailUrl(group.cards[0], filters.language)" :alt="group.cards[0].display_name" loading="lazy">
                    <div class="card-name" x-text="group.cards[0].display_name"></div>
                    <div class="card-qty" x-text="'Qty: ' + group.total_qty"></div>
                </div>
            </template>
        </div>
        
        <!-- Modal -->
        <div class="modal-overlay" x-show="selectedCard" @click.self="closeModal()" style="display: none;">
            <div class="modal" x-show="selectedCard">
                <button class="modal-close" @click="closeModal()">Ã—</button>
                
                <template x-if="selectedCard">
                    <div class="modal-content">
                        <!-- Left Column: Card Image -->
                        <div class="modal-image-container">
                            <img :src="getHighQualityUrl(selectedCard.cards[0], filters.language)" :alt="selectedCard.cards[0].display_name">
                        </div>
                        
                        <!-- Right Column: Card Information -->
                        <div class="modal-sections">
                            <!-- Basic Information -->
                            <div class="modal-section">
                                <div class="modal-section-title">Basic Information</div>
                                <table class="modal-table">
                                    <tr>
                                        <td>Display Name</td>
                                        <td x-text="selectedCard.cards[0].display_name"></td>
                                    </tr>
                                    <tr>
                                        <td>English Name</td>
                                        <td x-text="selectedCard.cards[0].name_en"></td>
                                    </tr>
                                    <tr>
                                        <td>Set</td>
                                        <td x-text="selectedCard.cards[0].set_id + ' #' + selectedCard.cards[0].card_number"></td>
                                    </tr>
                                    <tr>
                                        <td>TCGdex ID</td>
                                        <td x-text="selectedCard.tcgdex_id"></td>
                                    </tr>
                                    <tr x-show="selectedCard.cards[0].category">
                                        <td>Category</td>
                                        <td x-text="selectedCard.cards[0].category"></td>
                                    </tr>
                                    <tr x-show="selectedCard.cards[0].rarity">
                                        <td>Rarity</td>
                                        <td x-text="selectedCard.cards[0].rarity"></td>
                                    </tr>
                                    <tr x-show="selectedCard.cards[0].illustrator">
                                        <td>Illustrator</td>
                                        <td x-text="selectedCard.cards[0].illustrator"></td>
                                    </tr>
                                    <tr x-show="selectedCard.cards[0].regulation_mark">
                                        <td>Regulation Mark</td>
                                        <td x-text="selectedCard.cards[0].regulation_mark"></td>
                                    </tr>
                                </table>
                            </div>
                            
                            <!-- Pokemon Stats (only for Pokemon cards) -->
                            <div class="modal-section" x-show="selectedCard.cards[0].category === 'PokÃ©mon'">
                                <div class="modal-section-title">PokÃ©mon Stats</div>
                                <table class="modal-table">
                                    <tr x-show="selectedCard.cards[0].types">
                                        <td>Type(s)</td>
                                        <td>
                                            <template x-for="type in parseTypesArray(selectedCard.cards[0].types)">
                                                <span class="type-badge" x-text="type"></span>
                                            </template>
                                        </td>
                                    </tr>
                                    <tr x-show="selectedCard.cards[0].hp">
                                        <td>HP</td>
                                        <td x-text="selectedCard.cards[0].hp"></td>
                                    </tr>
                                    <tr x-show="selectedCard.cards[0].stage">
                                        <td>Stage</td>
                                        <td x-text="selectedCard.cards[0].stage"></td>
                                    </tr>
                                    <tr x-show="selectedCard.cards[0].evolve_from">
                                        <td>Evolves From</td>
                                        <td x-text="selectedCard.cards[0].evolve_from"></td>
                                    </tr>
                                    <tr x-show="selectedCard.cards[0].retreat_cost">
                                        <td>Retreat Cost</td>
                                        <td x-text="selectedCard.cards[0].retreat_cost"></td>
                                    </tr>
                                    <tr x-show="selectedCard.cards[0].description">
                                        <td>Description</td>
                                        <td x-text="selectedCard.cards[0].description"></td>
                                    </tr>
                                </table>
                            </div>
                            
                            <!-- Abilities -->
                            <div class="modal-section" x-show="selectedCard.cards[0].abilities">
                                <div class="modal-section-title">Abilities</div>
                                <table class="modal-table">
                                    <tr>
                                        <td colspan="2">
                                            <template x-for="ability in parseAbilities(selectedCard.cards[0].abilities)">
                                                <div class="ability-item">
                                                    <div>
                                                        <span class="ability-name" x-text="ability.name"></span>
                                                        <span x-show="ability.type" x-text="' (' + ability.type + ')'" style="color: #666; font-size: 12px;"></span>
                                                    </div>
                                                    <div class="ability-effect" x-show="ability.effect" x-text="ability.effect"></div>
                                                </div>
                                            </template>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            
                            <!-- Attacks -->
                            <div class="modal-section" x-show="selectedCard.cards[0].attacks">
                                <div class="modal-section-title">Attacks</div>
                                <table class="modal-table">
                                    <tr>
                                        <td colspan="2">
                                            <template x-for="attack in parseAttacks(selectedCard.cards[0].attacks)">
                                                <div class="attack-item">
                                                    <div>
                                                        <span class="attack-name" x-text="attack.name"></span>
                                                        <span class="attack-cost" x-show="attack.cost && attack.cost.length > 0" x-text="'[' + attack.cost.join(', ') + ']'"></span>
                                                        <span class="attack-damage" x-show="attack.damage" x-text="attack.damage"></span>
                                                    </div>
                                                    <div class="attack-effect" x-show="attack.effect" x-text="attack.effect"></div>
                                                </div>
                                            </template>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            
                            <!-- Weaknesses & Resistances -->
                            <div class="modal-section" x-show="selectedCard.cards[0].weaknesses || selectedCard.cards[0].resistances">
                                <div class="modal-section-title">Type Effectiveness</div>
                                <table class="modal-table">
                                    <tr x-show="selectedCard.cards[0].weaknesses">
                                        <td>Weakness</td>
                                        <td>
                                            <template x-for="weakness in parseTypeEffects(selectedCard.cards[0].weaknesses)">
                                                <span x-text="weakness.type + ' ' + weakness.value" style="margin-right: 8px;"></span>
                                            </template>
                                        </td>
                                    </tr>
                                    <tr x-show="selectedCard.cards[0].resistances">
                                        <td>Resistance</td>
                                        <td>
                                            <template x-for="resistance in parseTypeEffects(selectedCard.cards[0].resistances)">
                                                <span x-text="resistance.type + ' ' + resistance.value" style="margin-right: 8px;"></span>
                                            </template>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            
                            <!-- Trainer/Energy Effect -->
                            <div class="modal-section" x-show="selectedCard.cards[0].effect">
                                <div class="modal-section-title">Effect</div>
                                <table class="modal-table">
                                    <tr x-show="selectedCard.cards[0].trainer_type">
                                        <td>Trainer Type</td>
                                        <td x-text="selectedCard.cards[0].trainer_type"></td>
                                    </tr>
                                    <tr x-show="selectedCard.cards[0].energy_type">
                                        <td>Energy Type</td>
                                        <td x-text="selectedCard.cards[0].energy_type"></td>
                                    </tr>
                                    <tr>
                                        <td>Effect Text</td>
                                        <td x-text="selectedCard.cards[0].effect"></td>
                                    </tr>
                                </table>
                            </div>
                            
                            <!-- Legality -->
                            <div class="modal-section" x-show="selectedCard.cards[0].legal_standard !== null || selectedCard.cards[0].legal_expanded !== null">
                                <div class="modal-section-title">Format Legality</div>
                                <table class="modal-table">
                                    <tr x-show="selectedCard.cards[0].legal_standard !== null">
                                        <td>Standard</td>
                                        <td x-text="selectedCard.cards[0].legal_standard ? 'Legal' : 'Not Legal'"></td>
                                    </tr>
                                    <tr x-show="selectedCard.cards[0].legal_expanded !== null">
                                        <td>Expanded</td>
                                        <td x-text="selectedCard.cards[0].legal_expanded ? 'Legal' : 'Not Legal'"></td>
                                    </tr>
                                </table>
                            </div>
                            
                            <!-- Your Collection -->
                            <div class="modal-section">
                                <div class="modal-section-title">Your Collection</div>
                                <table class="modal-table">
                                    <template x-for="card in selectedCard.cards">
                                        <tr>
                                            <td x-text="capitalize(card.variant)"></td>
                                            <td x-text="card.quantity + 'x'"></td>
                                        </tr>
                                    </template>
                                </table>
                            </div>
                            
                            <!-- Price -->
                            <div class="modal-section" x-show="selectedCard.cards[0].price_eur || selectedCard.cards[0].price_usd">
                                <div class="modal-section-title">Pricing</div>
                                <table class="modal-table">
                                    <tr x-show="selectedCard.cards[0].price_eur">
                                        <td>EUR</td>
                                        <td x-text="'â‚¬' + selectedCard.cards[0].price_eur.toFixed(2)"></td>
                                    </tr>
                                    <tr x-show="selectedCard.cards[0].price_usd">
                                        <td>USD</td>
                                        <td x-text="'$' + selectedCard.cards[0].price_usd.toFixed(2)"></td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                </template>
            </div>
        </div>
    </div>
    
    <script>
        function cardApp() {
            return {
                stats: null,
                cards: [],
                cardGroups: [],
                filterOptions: {
                    types: [],
                    categories: [],
                    rarities: [],
                    stages: [],
                    sets: [],
                    regulation_marks: [],
                },
                filters: {
                    language: 'de',
                    name: '',
                    setId: '',
                    type: '',
                    category: '',
                    rarity: '',
                    stage: '',
                    regulationMark: '',
                    legalStandard: '',
                },
                loading: false,
                selectedCard: null,
                
                async init() {
                    await this.loadFilterOptions();
                    await this.loadStats();
                    await this.loadCards();
                },
                
                async loadFilterOptions() {
                    try {
                        const response = await fetch('/api/filter-options');
                        this.filterOptions = await response.json();
                    } catch (error) {
                        console.error('Failed to load filter options:', error);
                    }
                },
                
                async loadStats() {
                    try {
                        const response = await fetch('/api/stats');
                        this.stats = await response.json();
                    } catch (error) {
                        console.error('Failed to load stats:', error);
                    }
                },
                
                async loadCards() {
                    this.loading = true;
                    try {
                        const params = new URLSearchParams();
                        
                        // Add all filter parameters
                        if (this.filters.language) params.append('language', this.filters.language);
                        if (this.filters.name) params.append('name', this.filters.name);
                        if (this.filters.setId) params.append('set_id', this.filters.setId);
                        if (this.filters.type) params.append('card_type', this.filters.type);
                        if (this.filters.category) params.append('category', this.filters.category);
                        if (this.filters.rarity) params.append('rarity', this.filters.rarity);
                        if (this.filters.stage) params.append('stage', this.filters.stage);
                        if (this.filters.regulationMark) params.append('regulation_mark', this.filters.regulationMark);
                        if (this.filters.legalStandard) params.append('legal_standard', this.filters.legalStandard);
                        
                        const response = await fetch('/api/cards?' + params);
                        this.cards = await response.json();
                        this.groupCards();
                    } catch (error) {
                        console.error('Failed to load cards:', error);
                    } finally {
                        this.loading = false;
                    }
                },
                
                clearFilters() {
                    this.filters.name = '';
                    this.filters.setId = '';
                    this.filters.type = '';
                    this.filters.category = '';
                    this.filters.rarity = '';
                    this.filters.stage = '';
                    this.filters.regulationMark = '';
                    this.filters.legalStandard = '';
                    this.loadCards();
                },
                
                groupCards() {
                    const grouped = {};
                    for (const card of this.cards) {
                        if (!grouped[card.tcgdex_id]) {
                            grouped[card.tcgdex_id] = {
                                tcgdex_id: card.tcgdex_id,
                                cards: [],
                                total_qty: 0
                            };
                        }
                        grouped[card.tcgdex_id].cards.push(card);
                        grouped[card.tcgdex_id].total_qty += card.quantity;
                    }
                    this.cardGroups = Object.values(grouped);
                },
                
                getThumbnailUrl(card, lang) {
                    if (!card.image_url) return '';
                    return card.image_url
                        .replace('/en/', '/' + lang + '/')
                        .replace('/high.png', '/low.webp');
                },
                
                getHighQualityUrl(card, lang) {
                    if (!card.image_url) return '';
                    return card.image_url.replace('/en/', '/' + lang + '/');
                },
                
                parseTypes(types) {
                    if (!types) return '';
                    if (typeof types === 'string') {
                        try {
                            types = JSON.parse(types);
                        } catch {
                            return types;
                        }
                    }
                    return Array.isArray(types) ? types.join(', ') : types;
                },
                
                parseTypesArray(types) {
                    if (!types) return [];
                    if (typeof types === 'string') {
                        try {
                            types = JSON.parse(types);
                        } catch {
                            return [];
                        }
                    }
                    return Array.isArray(types) ? types : [];
                },
                
                parseAttacks(attacks) {
                    if (!attacks) return [];
                    if (typeof attacks === 'string') {
                        try {
                            attacks = JSON.parse(attacks);
                        } catch {
                            return [];
                        }
                    }
                    return Array.isArray(attacks) ? attacks : [];
                },
                
                parseAbilities(abilities) {
                    if (!abilities) return [];
                    if (typeof abilities === 'string') {
                        try {
                            abilities = JSON.parse(abilities);
                        } catch {
                            return [];
                        }
                    }
                    return Array.isArray(abilities) ? abilities : [];
                },
                
                parseTypeEffects(effects) {
                    if (!effects) return [];
                    if (typeof effects === 'string') {
                        try {
                            effects = JSON.parse(effects);
                        } catch {
                            return [];
                        }
                    }
                    return Array.isArray(effects) ? effects : [];
                },
                
                capitalize(str) {
                    return str.charAt(0).toUpperCase() + str.slice(1);
                },
                
                openModal(cardGroup) {
                    this.selectedCard = cardGroup;
                },
                
                closeModal() {
                    this.selectedCard = null;
                }
            };
        }
    </script>
</body>
</html>
